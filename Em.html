<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Adaptive Fictional Wordle</title>

<style>
@font-face {
  font-family: "Yeerial";
  src: url("downloads/yeerial.ttf") format("truetype");
}

body {
  font-family: "Yeerial", sans-serif;
  background: #f2f2f2;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 20px;
}

#game {
  display: grid;
  gap: 6px;
  margin-bottom: 20px;
}

.cell {
  width: 56px;
  height: 56px;
  border: 2px solid #aaa;
  text-align: center;
  font-size: 28px;
  line-height: 56px;
  background: white;
}

.correct { background: #6aaa64; color: white; }
.present { background: #c9b458; color: white; }
.absent  { background: #787c7e; color: white; }

#keyboard {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.key-row {
  display: flex;
  justify-content: center;
  gap: 6px;
}

.key {
  min-width: 36px;
  padding: 10px;
  background: #ddd;
  border-radius: 4px;
  cursor: pointer;
  user-select: none;
  text-align: center;
}

.key.wide { min-width: 64px; }

#controls {
  margin-bottom: 14px;
}
</style>
</head>
<body>

<div id="controls">
  <button onclick="resetGame()">RESET</button>
</div>

<div id="game"></div>
<div id="keyboard"></div>

<script>
let ANSWER = "";
let COLS = 0;
let ROWS = 0;

let row = 0;
let col = 0;
let guesses = [];

const game = document.getElementById("game");
const keyboard = document.getElementById("keyboard");

const layout = [
  ["Q","W","E","R","T","Y","U","I","O","P"],
  ["A","S","D","F","G","H","J","K","L"],
  ["ENTER","Z","X","C","V","B","N","M","⌫"]
];

layout.forEach(r => {
  const div = document.createElement("div");
  div.className = "key-row";
  r.forEach(k => {
    const key = document.createElement("div");
    key.className = "key";
    if (k === "ENTER" || k === "⌫") key.classList.add("wide");
    key.textContent = k;
    key.onclick = () => handleKey(k);
    div.appendChild(key);
  });
  keyboard.appendChild(div);
});

function initBoard() {
  game.innerHTML = "";
  game.style.gridTemplateColumns = `repeat(${COLS}, 56px)`;
  guesses = Array.from({ length: ROWS }, () => Array(COLS).fill(""));
  row = 0;
  col = 0;

  for (let i = 0; i < ROWS * COLS; i++) {
    const d = document.createElement("div");
    d.className = "cell";
    game.appendChild(d);
  }
}

function handleKey(k) {
  if (row >= ROWS) return;

  if (k === "⌫" && col > 0) {
    col--;
    guesses[row][col] = "";
    update();
    return;
  }

  if (k === "ENTER") {
    if (col === COLS) {
      check();
      row++;
      col = 0;
    }
    return;
  }

  if (col < COLS && k.length === 1) {
    guesses[row][col] = k;
    col++;
    update();
  }
}

function update() {
  document.querySelectorAll(".cell").forEach((cell, i) => {
    const r = Math.floor(i / COLS);
    const c = i % COLS;
    cell.textContent = guesses[r]?.[c] || "";
  });
}

function check() {
  for (let i = 0; i < COLS; i++) {
    const idx = row * COLS + i;
    const cell = game.children[idx];
    if (guesses[row][i] === ANSWER[i]) {
      cell.classList.add("correct");
    } else if (ANSWER.includes(guesses[row][i])) {
      cell.classList.add("present");
    } else {
      cell.classList.add("absent");
    }
  }
}

function resetGame() {
  pickWord();
}

function pickWord() {
  fetch("a.json")
    .then(r => r.json())
    .then(data => {
      const list = data.words.map(w => w.entry.form);
      ANSWER = list[Math.floor(Math.random() * list.length)].toUpperCase();
      COLS = ANSWER.length;
      ROWS = Math.max(4, Math.ceil(COLS * 1.2));
      initBoard();
      console.log("ANSWER:", ANSWER);
    });
}

pickWord();
</script>

</body>
</html>
