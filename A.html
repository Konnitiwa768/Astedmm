<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>OTFフォントパス反転プレビュー</title>
<script src="https://cdn.jsdelivr.net/npm/opentype.js@1.3.4/dist/opentype.min.js"></script>
<style>
  body { font-family: sans-serif; margin: 20px; }
  canvas { border: 1px solid #333; margin-top: 20px; }
</style>
</head>
<body>

<h1>OTFフォントパス反転プレビュー</h1>

<label for="fontUrl">フォントファイルのURL：</label><br>
<input type="text" id="fontUrl" style="width: 100%;" placeholder="例: https://example.com/fonts/myfont.otf"><br>
<button id="loadFont">フォント読み込み</button><br><br>

<label for="inputChar">文字：</label>
<input type="text" id="inputChar" value="A" maxlength="1" style="width: 50px;"><br><br>

<label><input type="checkbox" id="reversePath"> パスを反転</label><br><br>

<canvas id="canvas" width="300" height="300"></canvas>

<script>
  const fontUrlInput = document.getElementById('fontUrl');
  const loadBtn = document.getElementById('loadFont');
  const inputChar = document.getElementById('inputChar');
  const reversePath = document.getElementById('reversePath');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  let font = null;

  loadBtn.addEventListener('click', () => {
    const url = fontUrlInput.value.trim();
    if (!url) {
      alert('URLを入力してください');
      return;
    }

    opentype.load(url, (err, loadedFont) => {
      if (err) {
        alert('フォント読み込み失敗：' + err);
        return;
      }
      font = loadedFont;
      draw();
    });
  });

  inputChar.addEventListener('input', draw);
  reversePath.addEventListener('change', draw);

  function draw() {
    if (!font) return;

    const char = inputChar.value || 'A';
    const glyph = font.charToGlyph(char);

    const scale = 150 / font.unitsPerEm;
    const x = 50;
    const y = 200;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const path = glyph.getPath(x, y, 150);

    ctx.beginPath();
    for (let cmd of path.commands) {
      if (cmd.type === 'M') ctx.moveTo(cmd.x, cmd.y);
      else if (cmd.type === 'L') ctx.lineTo(cmd.x, cmd.y);
      else if (cmd.type === 'C') ctx.bezierCurveTo(cmd.x1, cmd.y1, cmd.x2, cmd.y2, cmd.x, cmd.y);
      else if (cmd.type === 'Q') ctx.quadraticCurveTo(cmd.x1, cmd.y1, cmd.x, cmd.y);
      else if (cmd.type === 'Z') ctx.closePath();
    }

    if (reversePath.checked) {
      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.scale(-1, 1);  // X軸反転
      ctx.translate(-canvas.width / 2, -canvas.height / 2);
      ctx.fill();
      ctx.restore();
    } else {
      ctx.fill();
    }
  }
</script>

</body>
</html>
